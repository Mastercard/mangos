[Distribution]
# I'm most comfortable debugging Ubuntu.
# If we do this right, it shouldn't matter.
Distribution=ubuntu
Repositories=main,universe
Release=oracular

[Content]
# Generated using `openssl passwd -6`
RootPassword=hashed:$6$OM2raXimIv8ucv8M$KwmcGa3kMjKlxvvpVdTVZ9khXy5pp2FJU0gNWqJ6nEMG7Yut2sxILhr7bs/yEC.WoUYP.hlBWt0zn4W7XCcyi.
KernelCommandLine=systemd.machine_id=firmware lsm=lockdown,capability,landlock,yama,apparmor,ima,evm,bpf

# System TZ should always be UTC. Users can set their own, if they want.
Timezone=UTC
Bootable=yes
Bootloader=systemd-boot
PostInstallationScripts=%D/resources/augment-os-release

RemoveFiles=
        /usr/share/locale/*

[Build]
BuildDirectory=%D/build
CacheDirectory=%D/.cache
# Make mkosi remember previous build. This improves cache use.
History=yes
# Reuses partial builds, so also improves cache use.
Incremental=yes

Environment=MANGOS_GITHUB_URL

[Config]
Profiles=verity-full,secureboot

[Include]
Include=%D/resources/common-kernel

[Output]
OutputMode=644
ImageId=mangos
Format=disk
OutputDirectory=out
SplitArtifacts=uki,kernel,initrd,partitions,roothash,tar
CompressOutput=none
ManifestFormat=json

[Content]
# Overrides the default initrd generation
Initrds=%O/initrd

Ssh=no
BaseTrees=%O/base_%v
Bootable=yes
Bootloader=systemd-boot
KernelModulesInitrd=yes

[Validation]
Checksum=yes
SecureBoot=yes
SignExpectedPcr=yes
SecureBootKey=%D/mkosi.key
SecureBootCertificate=%D/mkosi.crt

[Runtime]
Ephemeral=yes
KVM=yes
RuntimeNetwork=user
RuntimeSize=20G
Firmware=uefi
TPM=yes
Ephemeral=yes
RAM=4G
CPUs=2
VSock=yes
