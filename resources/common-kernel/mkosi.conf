[Content]
# These two are intentional. The first clears the existing list (from
# e.g. Include=mosi-initrd), the second populates it anew.
KernelModulesInclude=
# This is the list of modules that were loaded in a VM when it
# was done booting. This is a good starting point for the list.
KernelModulesInclude=
                ^fs/erofs/erofs.ko.zst
                ^fs/autofs/autofs4.ko.zst
                ^fs/overlayfs/overlay.ko.zst
                ^drivers/md/dm-verity.ko.zst
                ^drivers/md/dm-crypt.ko.zst

                fs/nls/nls_iso8859-1.ko.zst
                fs/xfs/xfs.ko.zst

                # This totals 1292kB for one of Ubuntu's 6.14.0 kernels.
                # That's small enough that the risk of accidentally missing something
                # isn't worth a more fine-grained approach.
                ^arch/

                # This totals 600kB, so same as above.
                ^crypto/

                # All of this is from using modprobe -R <each /sys/bus/*/devices/*/modalias>
                ^drivers/acpi/acpi_tad.ko.zst
                ^drivers/char/ipmi/ipmi_si.ko.zst
                ^drivers/char/ipmi/ipmi_ssif.ko.zst
                ^drivers/dma/ioat/ioatdma.ko.zst
                ^drivers/gpu/drm/mgag200/mgag200.ko.zst
                ^drivers/hwmon/acpi_power_meter.ko.zst
                ^drivers/input/misc/pcspkr.ko.zst
                ^drivers/mfd/lpc_ich.ko.zst
                ^drivers/misc/hpilo.ko.zst
                ^drivers/misc/mei/mei-me.ko.zst
                ^drivers/net/ethernet/intel/igb/igb.ko.zst
                ^drivers/net/fjes/fjes.ko.zst
                ^drivers/platform/x86/wmi.ko.zst
                ^drivers/scsi/sd_mod.ko.zst # Built-in in Ubuntu kernels
                ^drivers/scsi/ses.ko.zst
                ^drivers/scsi/smartpqi/smartpqi.ko.zst
                ^sound/drivers/pcsp/snd-pcsp.ko.zst
                ^drivers/thermal/intel/intel_pch_thermal.ko.zst
                ^drivers/usb/host/xhci-pci.ko.zst
                ^drivers/usb/storage/uas.ko.zst
                ^drivers/usb/storage/usb-storage.ko.zst
                ^drivers/watchdog/hpwdt.ko.zst

                # Anything below here is stuff that was loaded on the OEL7
                # I'm hijacking, and that isn't already listed above somewhere.
                ^block/bsg.ko.zst
                ^drivers/char/ipmi/ipmi_devintf.ko.zst
                ^drivers/edac/skx_edac.ko.zst
                ^drivers/hwmon/coretemp.ko.zst
                ^drivers/input/joydev.ko.zst
                ^drivers/md/dm-mirror.ko.zst
                ^drivers/md/raid1.ko.zst
                ^drivers/scsi/ses.ko.zst
                ^drivers/thermal/intel/intel_powerclamp.ko.zst

                ^fs/binfmt_misc.ko.zst
                ^net/bridge/bridge.ko.zst
                ^net/bridge/netfilter/ebtable_filter.ko.zst
                ^net/bridge/netfilter/ebtable_nat.ko.zst
                ^net/ipv4/netfilter/ipt_REJECT.ko.zst
                ^net/ipv4/netfilter/iptable_filter.ko.zst
                ^net/ipv4/netfilter/iptable_mangle.ko.zst
                ^net/ipv4/netfilter/iptable_nat.ko.zst
                ^net/ipv4/netfilter/iptable_raw.ko.zst
                ^net/ipv4/netfilter/iptable_security.ko.zst
                ^net/ipv6/netfilter/ip6t_REJECT.ko.zst
                ^net/ipv6/netfilter/ip6t_rpfilter.ko.zst
                ^net/ipv6/netfilter/ip6table_filter.ko.zst
                ^net/ipv6/netfilter/ip6table_mangle.ko.zst
                ^net/ipv6/netfilter/ip6table_nat.ko.zst
                ^net/ipv6/netfilter/ip6table_raw.ko.zst
                ^net/ipv6/netfilter/ip6table_security.ko.zst
                ^net/netfilter/ipset/ip_set.ko.zst
                ^net/netfilter/nf_tables.ko.zst
                ^net/netfilter/nft_chain_nat.ko.zst
                ^net/netfilter/nft_compat.ko.zst
                ^net/netfilter/xt_conntrack.ko.zst
                ^net/netfilter/xt_MASQUERADE.ko.zst
                ^net/netfilter/xt_addrtype.ko.zst


                # VMware stuff
                ^drivers/gpu/drm/vmwgfx/vmwgfx.ko.zst
                ^drivers/i2c/busses/i2c-piix4.ko.zst
                ^drivers/message/fusion/mptspi.ko.zst
                ^drivers/misc/vmw_vmci/vmw_vmci.ko.zst
                ^drivers/net/vmxnet3/vmxnet3.ko.zst

                # EC2 stuff
                ^drivers/nvme/host/nvme.ko.zst
                ^drivers/nvme/host/nvme-core.ko.zst
                ^drivers/net/ethernet/amazon/ena/ena.ko.zst


                # TODO: Everything below here is kind of a mess. Lots of dupes, etc.
                ^drivers/ata/ahci.ko.zst
                ^drivers/char/hw_random/virtio-rng.ko.zst
                ^drivers/firmware/dmi-sysfs.ko.zst
                ^drivers/firmware/efi/efi-pstore.ko.zst
                ^drivers/firmware/qemu_fw_cfg.ko.zst

                ^drivers/i2c/busses/i2c-i801.ko.zst
                ^drivers/input/mouse/psmouse.ko.zst
                ^drivers/powercap/intel_rapl_common.ko.zst
                ^drivers/scsi/virtio_scsi.ko.zst
                ^fs/netfs/netfs.ko.zst

                ^net/packet/af_packet.ko.zst
                ^net/sched/sch_fq_codel.ko.zst
                ^net/vmw_vsock/

                ^drivers/acpi/acpi_pad.ko.zst
                ^drivers/acpi/acpi_tad.ko.zst
                ^drivers/bluetooth/btusb.ko.zst
                ^drivers/edac/igen6_edac.ko.zst
                ^drivers/gpu/drm/i915/i915.ko.zst
                ^drivers/gpu/drm/xe/xe.ko.zst
                ^drivers/hid/hid-generic.ko.zst
                ^drivers/hid/hid-logitech-dj.ko.zst
                ^drivers/hid/hid-logitech-hidpp.ko.zst
                ^drivers/hid/i2c-hid/i2c-hid-acpi.ko.zst
                ^drivers/hid/i2c-hid/i2c-hid.ko.zst
                ^drivers/hid/usbhid/usbhid.ko.zst
                ^drivers/hid/usbhid/usbkbd.ko.zst
                ^drivers/hid/usbhid/usbmouse.ko.zst
                ^drivers/input/serio/serio_raw.ko.zst
                ^drivers/memstick/host/rtsx_usb_ms.ko.zst
                ^drivers/mfd/intel-lpss-pci.ko.zst
                ^drivers/misc/cardreader/rtsx_usb.ko.zst
                ^drivers/mmc/host/rtsx_usb_sdmmc.ko.zst
                ^drivers/mmc/host/sdhci-pci.ko.zst
                ^drivers/net/ethernet/intel/e1000/e1000.ko.zst
                ^drivers/net/ethernet/realtek/r8169.ko.zst
                ^drivers/net/phy/realtek.ko.zst
                ^drivers/net/veth.ko.zst
                ^drivers/net/wireless/intel/iwlwifi/iwlwifi.ko.zst
                ^drivers/pinctrl/intel/pinctrl-alderlake.ko.zst
                ^drivers/platform/x86/intel/pmc/intel_pmc_core.ko.zst
                ^drivers/spi/spi-intel-pci.ko.zst

KernelModulesExclude=.*
Packages=linux-image-generic
         libbpf1
#ExtraTrees=%D/kernel
