#!/bin/sh

outdir="$1"

if ! grep -q mangos_install_target= /proc/cmdline
then
        exit 0
fi

target=$(sed -e 's%.*mangos_install_target=\([a-z0-9/.-]\+\).*%\1%' /proc/cmdline)
unit="$(systemd-escape ${target}).device"

cat << EOF > "${outdir}/mangos-install.service.d/target-device.conf"
# Automatically generated by mangos-installer-device-dependency

[Unit]
Requires=${unit}
EOF
